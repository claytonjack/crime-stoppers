<app-header title="Crime Statistics"></app-header>

<ion-content [fullscreen]="true">
	<div class="ion-padding">

		<!-- Loading State -->
		<div *ngIf="isLoading" class="loading-container">
			<ion-spinner name="crescent"></ion-spinner>
			<p>Loading crime statistics...</p>
		</div>

		<!-- Error State -->
		<div *ngIf="error && !isLoading" class="error-container">
			<p class="error-text">{{ error }}</p>
			<ion-button fill="outline" color="primary" (click)="refreshData()">
				<ion-icon name="refresh-outline" slot="start"></ion-icon>
				Retry
			</ion-button>
		</div>

		<!-- Main Content -->
		<div *ngIf="!isLoading && !error">

			<!-- Quick Stats Summary -->
			<ion-card>
				<ion-card-header>
					<ion-card-title>Crime Overview</ion-card-title>
				</ion-card-header>
				<ion-card-content>
					<ion-grid>
						<ion-row>
							<ion-col size="6">
								<div class="stat-item">
									<h3>{{ totalCrimesLast12Months }}</h3>
									<p>Total Incidents</p>
								</div>
							</ion-col>
							<ion-col size="6">
								<div class="stat-item">
									<h3>{{ topCrimeType }}</h3>
									<p>Most Common Type</p>
								</div>
							</ion-col>
						</ion-row>
					</ion-grid>
				</ion-card-content>
			</ion-card>

			<!-- City Selector with Accordion -->
			<ion-accordion-group>
				<ion-accordion>
					<ion-item slot="header" color="light">
						<ion-label>Select Your City</ion-label>
					</ion-item>
					<div class="ion-padding" slot="content">
						<div class="city-selector">
							<ion-chip [class]="getCityButtonClass('ALL')" (click)="selectCity('ALL')">
								All Cities
								<span class="city-count">({{ totalCrimesLast12Months }})</span>
							</ion-chip>
							<ion-chip *ngFor="let city of availableCities" [class]="getCityButtonClass(city)"
								(click)="selectCity(city)">
								{{ formatCityName(city) }}
								<span *ngIf="cityStats[city]" class="city-count">({{ cityStats[city] }})</span>
							</ion-chip>
						</div>
					</div>
				</ion-accordion>
			</ion-accordion-group>

			<!-- Monthly Trend Chart -->
			<ion-card>
				<ion-card-header>
					<ion-card-title>Monthly Crime Trends (Rolling 12 Months)</ion-card-title>
				</ion-card-header>
				<ion-card-content>
					<div class="chart-container">
						<canvas baseChart
							*ngIf="monthlyChartData.datasets && monthlyChartData.datasets.length > 0; else noMonthlyData"
							[data]="monthlyChartData" [options]="monthlyChartOptions" type="line">
						</canvas>
						<ng-template #noMonthlyData>
							<p class="no-data-message">No data available for the selected criteria.</p>
						</ng-template>
					</div>
				</ion-card-content>
			</ion-card>

			<!-- Crime Type Comparison Chart -->
			<ion-card>
				<ion-card-header>
					<ion-card-title>Crime Types Comparison</ion-card-title>
				</ion-card-header>
				<ion-card-content>
					<div class="chart-container">
						<canvas baseChart
							*ngIf="crimeTypeChartData.datasets && crimeTypeChartData.datasets.length > 0; else noCrimeTypeData"
							[data]="crimeTypeChartData" [options]="crimeTypeChartOptions" type="bar">
						</canvas>
						<ng-template #noCrimeTypeData>
							<p class="no-data-message">No data available for the selected criteria.</p>
						</ng-template>
					</div>
				</ion-card-content>
			</ion-card>

		</div>
	</div>
</ion-content>