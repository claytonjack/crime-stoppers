<app-header title="Event Details" [showMenuButton]="false">
	<ion-button slot="start" (click)="goBack()" aria-label="Go back">
		<ng-icon slot="icon-only" name="bootstrapArrowLeft"></ng-icon>
	</ion-button>
</app-header>

<ion-content [fullscreen]="true">
	@if (isLoading()) {
	<div class="loading-container">
		<ion-spinner name="crescent"></ion-spinner>
		<ion-text>
			<p>Loading event...</p>
		</ion-text>
	</div>
	}

	@if (error() && !isLoading()) {
	<div class="error-container">
		<ng-icon name="bootstrapExclamationTriangle" size="64" color="danger"></ng-icon>
		<ion-text color="danger">
			<h3>Error</h3>
			<p>{{ error() }}</p>
		</ion-text>
		<ion-button fill="outline" (click)="goBack()">
			Go Back
		</ion-button>
	</div>
	}

	@if (event() && !isLoading() && !error()) {
	<div class="event-content">
		@if (event()!.Images && event()!.Images!.length > 0) {
		<div class="images-section">
			<swiper-container slides-per-view="1" navigation="true" pagination="true" loop="false" class="event-swiper"
				(swiperslidechange)="onSwiperSlideChange($event)">
				@for (image of event()!.Images!; track image.documentId; let i = $index) {
				<swiper-slide>
					<div class="slide-container">
						<ion-img [src]="getImageUrl(image.url)" [alt]="image.alternativeText || event()!.Title"
							(click)="onImageClick(i)" class="slide-image" loading="lazy">
						</ion-img>
					</div>
				</swiper-slide>
				}
			</swiper-container>

			@if (event()!.Images!.length > 1) {
			<div class="image-counter">
				{{ selectedImageIndex() + 1 }} / {{ event()!.Images!.length }}
			</div>
			}
		</div>
		}

		<div class="info-section">
			<div class="event-card">
				<div class="card-header-section">
					<h1 class="event-title">{{ event()!.Title }}</h1>

					<div class="date-calendar-container">
						<div class="date-time-container">
							<ng-icon name="bootstrapCalendarEvent"></ng-icon>
							<span class="date-time-text">{{ formatDateTime(event()!.Event_Time) }}</span>
						</div>
						<ion-badge class="calendar-badge" (click)="addToCalendar(event())">
							Save Event
						</ion-badge>
					</div>

					@if (event()!.Location) {
					<div class="location-container">
						<ng-icon name="bootstrapGeoAlt"></ng-icon>
						<span class="location-text">{{ event()!.Location }}</span>
					</div>
					}
				</div>

				@if (event()!.Body) {
				<div class="card-content-section">
					<div class="event-body">
						<ion-text>
							<div [innerHTML]="event()!.Body"></div>
						</ion-text>
					</div>
				</div>
				}
			</div>
		</div>
	</div>
	}

	<ion-modal [isOpen]="isImageModalOpen()" (didDismiss)="closeImageModal()">
		<ng-template>
			<ion-header>
				<ion-toolbar>
					<ion-title>Image {{ selectedImageIndex() + 1 }} of {{ event()?.Images?.length || 0 }}</ion-title>
					<ion-buttons slot="end">
						<ion-button (click)="closeImageModal()">
							<ng-icon name="bootstrapX" slot="icon-only"></ng-icon>
						</ion-button>
					</ion-buttons>
				</ion-toolbar>
			</ion-header>

			<ion-content>
				@if (event()?.Images && event()!.Images![selectedImageIndex()]) {
				<div class="modal-image-container">
					<ion-img [src]="getImageUrl(event()!.Images![selectedImageIndex()].url)"
						[alt]="event()!.Images![selectedImageIndex()].alternativeText || event()!.Title" class="modal-image"
						loading="lazy">
					</ion-img>
				</div>
				}
			</ion-content>
		</ng-template>
	</ion-modal>
</ion-content>